<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout/layout}">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="author" content="Untree.co" />
<meta name="description" content="" />
<meta name="keywords" content="bootstrap, bootstrap5" />
<title>User MyConsult</title>
<style>
.table {
	text-align: center;
	margin-top: 50px;
	margin-bottom: 50px;
}

.table td img {
	max-width: 100%;
}

.alert {
	position: relative;
	padding: 2rem 2rem;
	margin-bottom: 1rem;
	border: none solid transparent;
	border-radius: 0.25rem;
	font-size: 1.6rem;
}
</style>
</head>
<body>
	<div layout:fragment="content">
		<div class="card">
			<input type="hidden" id="memberId"
				th:value="${#authentication.principal.member.memberId}" />
			<div class="alert alert-light-primary color-primary">My Consult</div>
			<div class="card-body">
				<!-- 진행중인 상담이 없을 때 -->
				<div class="row" th:if="${#lists.isEmpty(consultList)}">
					<table class="table">
						<tr>
							<td><h3 class='error-title'>진행중인 Class가 없습니다.</h3>
								<br>
							<h4>새로운 class를 신청해주세요.</h4></td>
						</tr>
						<tr>
							<td>Go Mypage</td>
						</tr>
					</table>
				</div>
				<!-- 진행중인 상담이 있을 때 -->
				<div class="row" th:unless="${#lists.isEmpty(consultList)}">
					<div th:each="con : ${consultList}" style="width: 380px;">
						<div th:if="${con.ennc == '활성화'}">
							<table class="table table-bordered" style="width: 350px;">
								<tr style="display: none;">
									<td th:text="${con.consultNo}"></td>
								</tr>
								<tr>
									<td th:text="${con.title}"></td>
								</tr>
								<tr>
									<td th:text="'가이드  / '+${con.guideId}"></td>
								</tr>
								<tr>
									<td th:text="'상담일  / '+${con.conday}"></td>
								</tr>
								<tr>
									<td th:text="'상담 시작시간  / '+${con.stime}"></td>
								</tr>
								<tr>
									<td>
										<button class="btn btn-primary py-2 px-3 consultChat">채팅방</button>
										<button class="btn btn-primary py-2 px-3 consultReview">리뷰</button>
									</td>
								</tr>
							</table>
						</div>
						<!-- 상담이 비활성화일 때 -->
						<div th:if="${con.ennc == '비활성화'}" style="width: 380px;">
							<table border="1" class="table table-borderless"
								style="width: 350px;">
								<tr>
									<td><h3 class='error-title'>비활성화된 상담입니다.</h3>
										<h4>새로운 class를 신청해주세요.</h4></td>
								</tr>
								<tr>
									<td><h6>가이드의 요청에 의해 비활성화중입니다.</h6></td>
								</tr>
								<tr>
									<td><h6>문의할 점이 있으시면 Q&A센터로 문의해주시기바랍니다.</h6></td>
								</tr>
								<tr>
									<td><button class="btn btn-primary py-2 px-3 qnaList">Q&A</button></td>
								</tr>
							</table>
						</div>
					</div>
				</div>
			</div>
		</div>
		<script>
			//채팅방 연결
			$(".consultChat").on("click", function(e) {
				let consultNo = $(e.target).parent().parent().prev().prev().prev().prev().prev().children(0).html();
				console.log(consultNo);
				//let memberId = $("#memberId").val();
				//console.log(memberId);
				location.href="/consultChat.do?consultNo="+consultNo;
			})
			
			$(".consultReview").on("click", function(e){
				location.href="/conReview";
			})

			$(".qnaList").on("click", function(e) {
				location.href = "/qnaList.do";
			})
		</script>
	</div>

</body>
</html>