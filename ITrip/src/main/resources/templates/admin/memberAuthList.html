<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout/layout}">
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
	<div layout:fragment="content">
		<div class="row" id="table-head">
			<div class="col-12">
				<div class="card">
					<div class="card-header">
						<h4 class="card-title">회원정보</h4>
					</div>
					<div class="card-content">
						<div class="card-body">
							<p>GUIDE신청한 회원입니다. 권한을 수정하세요.</p>
						</div>
						<div class="table-responsive">
							<table class="table table-light mb-0">
								<thead>
									<tr>
										<th>아이디</th>
										<th>닉네임</th>
										<th>직무</th>
										<th>경력</th>
										<th>설명</th>
										<th>권한</th>
										<th>권한수정</th>
									</tr>
								</thead>
								<tbody>
									<tr th:each="g:${memberList}">
										<th th:text=${g.guideId}></th>
										<td th:text=${g.nick}></td>
										<td th:text=${g.duty}></td>
										<td th:text=${g.career}></td>
										<td th:text=${g.dc}></td>
										<td th:text=${g.cdName}></td>
										<td th:id="${g.guideId }">
											<input type="button" th:onclick="updateFnc(this.getAttribute('id'))"
											class="btn btn-primary btn-l" value="수정" th:name="${g.guideId}" th:id="${g.guideId}">
										</td>
									</tr>
								</tbody>
							</table>
						</div>
					</div>
				</div>
			</div>
		</div>
		
		<script type="text/javascript">

		function updateFnc(memId){
			console.log("zz"+memId);
			let modifyTd = document.getElementById(memId);
			//console.log(modifyTd.previousElementSibling.innerText)
			//console.log(modifyTd.firstElementChild )
			modifyTd.previousElementSibling.innerText="";
			
			let td = modifyTd.previousElementSibling
			let select =  document.createElement('select');
			select.setAttribute('id','sel');
			let author = ['=====','승인요청','승인수락','승인거절'];
			
			let option = "";
			author.forEach(function (ath,idx) {
				console.log(idx)
				select.innerHTML += '<option value='+idx+'>'+ ath +'</option>';
			})
			select.append(option)
			td.append(select)
			
			let btn = modifyTd.firstElementChild  
			btn.value='수정완료';
			
			let opVal = "";
			$("#sel").change(function(){
				opVal = $(this).val();
				console.log("선택값:"+$(this).val())
			})
			
			
			btn.addEventListener('click',function(e){
				e.preventDefault();
				fetch('memberAuthUpdate.do',{
					method:'post',
					headers: {
						'Content-type': 'application/x-www-form-urlencoded'
					},
					body:{"guideId":memId,"stateCd":opVal}
				})
				.then(function(result) {
					return result.json();
				})
				.then(function(result) {
					console.log(result);
					alert('수정완료')
					location.href="memberAuthList.do"
				})
				.catch(function(err) {
					console.error(err);
					alert('수정에러')
					location.href="memberAuthList.do"
				})
			})
			
			
		}
		
		</script>
	</div>
</body>
</html>