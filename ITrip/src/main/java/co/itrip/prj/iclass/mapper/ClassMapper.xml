<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="co.itrip.prj.iclass.mapper.ClassMapper">

	<insert id="classInsert" >
		<selectKey keyProperty="classNo" order="BEFORE" resultType="int">
			SELECT CASE WHEN MAX(CLASS_NO) IS NULL THEN 1 ELSE MAX(CLASS_NO)+1 END AS ID FROM CLASS
		</selectKey>
		INSERT INTO CLASS VALUES (#{classNo}, #{title}, #{content}, #{crclm}, sysdate, #{price}, #{attach}, 
		                          #{attachDir}, 'S1', #{guideId}, #{jobCd}, #{psncpa},  #{classCnt})
	</insert>
	
	<insert id="classDtInsert" >
		 <selectKey keyProperty="ctimeNo" order="BEFORE" resultType="int">
         SELECT 
             CASE WHEN MAX(CTIME_NO) IS NULL THEN 1
             ELSE MAX(CTIME_NO) +1 
             END AS NO
         FROM CLASS_DT
         WHERE CLASS_NO = #{classNo}
      </selectKey>
		insert into class_dt values (#{ctimeNo}, #{classNo}, #{term}, #{beginTime}, #{endTime}) 
	</insert>

	<select id="classList" resultType="co.itrip.prj.iclass.service.ClassVO"
			 parameterType="co.itrip.prj.iclass.service.ClassVO">
		select c.class_no,c.title,c.content,c.dt,c.price,c.crclm,
			c.attach,c.attach_dir,c.confm_cd,c.guide_id,c.job_cd,c.psncpa,c.class_cnt,c.ennc,cm.cd_name 
			from class c ,cmmncd cm 
			where cm.cd_ini = 'J' 
			and cm.cd_no = c.job_cd	 
	</select>
	
	<select id="classDtList" resultType="co.itrip.prj.iclass.service.ClassDtVO"
		parameterType="co.itrip.prj.iclass.service.ClassDtVO">
		select * from  class_dt where class_no=#{classNo}
		</select>
	
	<select id="classSelectOne" parameterType="co.itrip.prj.iclass.service.ClassVO" 
		resultType="co.itrip.prj.iclass.service.ClassVO">
		select c.class_no,c.title,c.content,c.dt,c.price,c.crclm,
			c.attach,c.attach_dir,c.confm_cd,c.guide_id,c.job_cd,c.psncpa,c.class_cnt,c.ennc,cm.cd_name 
			from class c ,cmmncd cm 
			where cm.cd_ini = 'J' 
			and cm.cd_no = c.job_cd 
			and class_no = #{classNo}
	</select>
</mapper>